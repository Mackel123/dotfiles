# vim: filetype=zsh

# MNEMONIC: [F]uzzy search [R]ip[G]rep
# SYNOPSIS: same with rg
# DESCRIPTION: Fuzzy search for the results of rg and open the corresponding file using $EDITOR with the cursor positioned on the matching line

local file
local line

# Feed rg results into fzf and use awk to extract the file name and the target line number.
# Preview the file with the target line highlighted in the center of the preview window.
# Use ctrl-t to open the selection via EDITOR in a separate iTerm2 window
read -r file line <<<$(rg --line-number --color=always --smart-case $@ \
                      | fzf --ansi \
                            --exit-0 \
                            --select-1 \
                            --delimiter : \
                            --preview 'bat --color=always --style=numbers,changes,header --theme=Dracula --highlight-line {2} {1}' \
                            --preview-window +{2}-/2 \
                            --bind 'ctrl-t:execute[/Users/yanzhang/.config/bin/iterm "cd $(pwd) && $EDITOR {1} +{2} "]' \
                            --header 'CTRL-t: open selections via EDITOR in a separate iTerm2 window' \
                      | awk -F: '{print $1, $2}')

if [[ -n $file ]]
then
  $EDITOR $file +$line
fi
